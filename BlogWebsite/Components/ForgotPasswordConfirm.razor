@page "/ForgotPasswordConfirmation"

@using System.Web
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage


@inject Blazored.SessionStorage.ISessionStorageService sessionStorage

@inject Microsoft.AspNetCore.Components.NavigationManager NavigationManager

<PageTitle>Forgot password confirmation</PageTitle>

<h1>Forgot password confirmation</h1>

<EditForm Model="codeInput" FormName="forgot-password"  method="post">
    <DataAnnotationsValidator />
    <ValidationSummary class="text-danger" role="alert" />

    <div class="container">
        <h1>Verify Code</h1>
        <div class="form-group">
            @* <label for="code">Enter Code:</label> *@
            @* <input type="text" class="form-control" id="code" @bind="codeInput.code" placeholder="Enter your code" /> *@
            <InputText @bind-Value="codeInput.code" class="form-control" aria-required="true" placeholder="Enter your code" />
            <label for="code" class="form-label">Enter Code:</label>
            <ValidationMessage For="() => codeInput.code" class="text-danger" />
        </div>
        <button class="btn btn-primary" @onclick="VerifyCodeAsync">Verify</button>
    </div>
</EditForm>

@code {
    private InputCode codeInput { get; set; } = new();

    private async Task VerifyCodeAsync()
    {
        var code = await sessionStorage.GetItemAsync<string>("ResetPasswordCode");
        Console.WriteLine("\ncc\n");
        Console.WriteLine(code);
        if (code == codeInput.code)
        {
            NavigationManager.NavigateTo("/");
        }
        else
        {

            NavigationManager.NavigateTo("Account/Login");
        }
    }

    private sealed class InputCode
    {
        public string code { get; set; } = "";
    }
}
